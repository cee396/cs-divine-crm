"use strict";(()=>{var e={};e.id=178,e.ids=[178],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4773:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>w,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{POST:()=>m,dynamic:()=>d});var o=r(9182),s=r(2007),n=r(6719),i=r(3442),l=r(5970);function p(e){if(!e||""===e.trim()||"null"===e.toLowerCase())return null;let t=parseFloat(e.replace(/[$,]/g,""));return isNaN(t)?null:t}let d="force-dynamic",u={parcel_id:"parcelId",parcel_number:"parcelId",parcel:"parcelId",property_address:"propertyAddress",address:"propertyAddress",property_city:"propertyCity",city:"propertyCity",property_state:"propertyState",state:"propertyState",property_zip:"propertyZip",zip:"propertyZip",zipcode:"propertyZip",county:"county",property_type:"propertyType",land_use:"landUse",acres:"acres",square_feet:"squareFeet",year_built:"yearBuilt",bedrooms:"bedrooms",bathrooms:"bathrooms",owner_name:"ownerName",owner:"ownerName",owner_address:"ownerAddress",owner_city:"ownerCity",owner_state:"ownerState",owner_zip:"ownerZip",owner_phone:"ownerPhone",phone:"ownerPhone",owner_email:"ownerEmail",email:"ownerEmail",mailing_address:"mailingAddress",mailing_city:"mailingCity",mailing_state:"mailingState",mailing_zip:"mailingZip",taxes_owed:"taxesOwed",amount_owed:"taxesOwed",tax_amount:"taxesOwed",years_delinquent:"yearsDelinquent",sale_date:"saleDate",certificate_number:"certificateNumber",bid_amount:"bidAmount",redemption_amount:"redemptionAmount",interest_rate:"interestRate",assessed_value:"assessedValue",market_value:"marketValue",land_value:"landValue",building_value:"buildingValue",exemptions:"exemptions",latitude:"latitude",longitude:"longitude",subdivision:"subdivision",section:"section",township:"township",range:"range",deed_book:"deedBook",deed_page:"deedPage",plat_book:"platBook",plat_page:"platPage",legal_description:"legalDescription",zoning:"zoning",flood_zone:"floodZone",school_district:"schoolDistrict"};function c(e){let t=[],r="",a=!1,o=0;for(;o<e.length;){let s=e[o],n=e[o+1];if('"'===s){if(a&&'"'===n){r+='"',o+=2;continue}a=!a}else","!==s||a?r+=s:(t.push(r),r="");o++}return t.push(r),t}async function m(e){try{let t=(await e.formData()).get("file");if(!t)return i.NextResponse.json({success:!1,error:"No file provided"},{status:400});if(!t.name.endsWith(".csv"))return i.NextResponse.json({success:!1,error:"Only CSV files are supported"},{status:400});let r=(await t.text()).split("\n").filter(e=>e.trim());if(r.length<2)return i.NextResponse.json({success:!1,error:"CSV file must contain at least a header and one data row"},{status:400});let a=r[0],o=c(a).map(e=>e.trim()),s={},n=1;o.forEach((e,t)=>{let r=u[e.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")];r?s[t]=r:e.trim()&&(s[t]=`field${n}`,n++)});let d=r.length-1,m=0,w=0,_=[],g=await l._.uploadSession.create({data:{filename:t.name,totalRecords:d,successRecords:0,errorRecords:0,status:"Processing"}});for(let e=1;e<r.length;e++)try{let t=r[e],a=c(t),o={status:"New Lead"};if(a.forEach((e,t)=>{let r=s[t];if(r&&e?.trim()){let t=e.trim();if(["taxesOwed","assessedValue","marketValue","landValue","buildingValue","exemptions","bidAmount","redemptionAmount","interestRate","acres","squareFeet","estimatedValue","repairCosts","marketRent","propertyTaxes","insurance","hoa","latitude","longitude","bathrooms"].includes(r))o[r]=p(t);else if(["yearBuilt","bedrooms","yearsDelinquent","contactAttempts"].includes(r)){let e=p(t);o[r]=e?Math.floor(e):null}else"saleDate"===r?o[r]=function(e){if(!e||""===e.trim()||"null"===e.toLowerCase())return null;let t=new Date(e);return isNaN(t.getTime())?null:t}(t):o[r]=t&&""!==t.trim()&&"null"!==t.toLowerCase()&&"undefined"!==t.toLowerCase()?t.trim():null}}),!o.parcelId&&!o.propertyAddress&&!o.ownerName){w++,_.push(`Row ${e+1}: Missing required data (parcel ID, property address, or owner name)`);continue}if(o.parcelId&&await l._.lead.findFirst({where:{parcelId:o.parcelId}})){w++,_.push(`Row ${e+1}: Duplicate parcel ID ${o.parcelId}`);continue}await l._.lead.create({data:o}),m++}catch(t){w++,_.push(`Row ${e+1}: ${t instanceof Error?t.message:"Unknown error"}`),console.error(`Error processing row ${e+1}:`,t)}return await l._.uploadSession.update({where:{id:g.id},data:{successRecords:m,errorRecords:w,status:"Completed",completedAt:new Date,errors:JSON.stringify(_)}}),i.NextResponse.json({success:!0,totalRecords:d,successRecords:m,errorRecords:w,errors:_.slice(0,10),uploadSessionId:g.id})}catch(e){return console.error("CSV upload error:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error occurred during upload"},{status:500})}}let w=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/upload-csv/route",pathname:"/api/upload-csv",filename:"route",bundlePath:"app/api/upload-csv/route"},resolvedPagePath:"/home/ubuntu/tax-deed-crm-enterprise/app/app/api/upload-csv/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:g,serverHooks:y}=w,f="/api/upload-csv/route";function h(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},5970:(e,t,r)=>{r.d(t,{_:()=>o});let a=require("@prisma/client"),o=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[372,609],()=>r(4773));module.exports=a})();